<?xml version="1.0"?>
<!DOCTYPE document PUBLIC
  "-//Apache Software Foundation//DTD XDOC 1.0//EN"
  "http://maven.apache.org/dtd/xdoc_1_0.dtd">
    <!--
        Please edit this file with the Eclipse XML editor, set your XML editor to a line length of 128 characters, indent-size
        of 4 characters and not using tab-characters, and format the file (Ctrl-Shift-F) before checking in. This should
        minimize the number of non-significant differences when comparing versions.
    -->
<document>
    <properties>
        <title>Mod4j Developer Guide</title>
    </properties>
    <body>
        <section name="Mod4j Developer Guide">
            <p> This Developer Guide helps developers of the Mod4j project to get started with coding and modeling.</p>
            <subsection name="Getting started">
                <ol>
                    <li>
                        Make sure you've installed Java JDK version 5 (1.5.0_15 or higher). You can download one from the
                        <a href="http://java.sun.com/javase/downloads/index.jsp">Sun download site</a>
                        .
                    </li>
                    <li>
                        Install Eclipse Ganymede 3.4 SR1 for Java2EE Developers. You can download one from the Eclipse
                        <a href="http://www.eclipse.org/downloads">download site.</a>
                        <br />
                    </li>
                    <li>
                        Install, using the Update Manager, at least the following plugins into Eclipse:
                        <ul>
                            <li>
                                OpenArchitectureWare Eclipse 4.3.0 (4.3.0.20080508-1430PRD).
                                <b>
                                    Update site:
                                    <code>http://www.openarchitectureware.org/updatesite/milestone/4.3.0/
                                    </code>
                                </b>
                            </li>
                            <li>
                                QforEclipse 0.8.1 Eclipse plugin for Maven2 projects.
                                <b>
                                    Update site:
                                    <code>http://q4e.googlecode.com/svn/trunk/updatesite
                                    </code>
                                </b>
                            </li>
                        </ul>
                    </li>
                    <li> Make sure the text file encoding in Eclipse is set to 'UTF-8'. You can verify and set this in the field
                        'Text file encoding' by navigating to 'Window -> Preferences... -> General -> Workspace'. For Linux
                        users UTF-8 is usually the platform encoding, and no change will be necessary. </li>
                    <li>
                        Install Apache Maven 2.0.9 or higher. For download and install instructions see the
                        <a href="http://maven.apache.org">Apache Maven site</a>
                    </li>
                </ol>
            </subsection>
            <subsection name="Checking out, import into Eclipse, generating the DSL-editors">
                <p> While the metamodel and its associated syntax is still under development, you should be prepared to
                    generate
                    the model editors yourself from the metamodel and the syntax definitions, before you can start modeling: </p>
                <p>
                    <b>Hybrids</b>
                    <br />
                    Important to know is, that the Mod4j modules that you are going to checkout from the repository,
                    do have a
                    hybrid nature. Some of the modules are Eclipse plug-ins and some are Maven modules. But the most
                    modules are
                    both: Eclipse plug-in and configured as a Maven module (yes, you can recognize them by the
                    pom.xml file).
                    <br />
                    This last category, the hybrids, must be treated with extra care. It mainly implies that you as a developer
                    must know that dependencies must be manually managed in two places within the module. In the manifest
                    (Eclipse plug-in) and in the pom.xml file (Maven) of the module. Also, in an equal manner, the versions of
                    the module must be maintained manually twice.
                    <br />
                    At the moment we do not have a suitable solution for automating this process, maybe in the future we will
                    extend our mod4j-maven-plugin with this functionality or see if the maven-eclipse-plugin can help us out.
                </p>
                <ol>
                    <li>
                        Check out the source code of the
                        <code>mod4j</code>
                        project from the Subversion URL
                        <code>https://svn.codehaus.org/mod4j/trunk</code>
                        into a directory on your file system. See the link
                        <a href="source-repository.html">Project information</a>
                        for information on how to do this.
                    </li>
                    <li>
                        Choose "Import" > "
                        <b>Existing Project into Workspace</b>
                        " and Browse to the
                        <code>../modules/Crossx</code>
                        folder. After choosing "Ok and "Finish" the following modules are imported in your workspace:
                        <br />
                        <code>org.mod4j.crossx.mm</code>
                        <br />
                        <code>org.mod4j.crossx.broker</code>
                    </li>
                    <li>
                        Even so do this with:
                        <br />
                        <code>modules/org.mod4j.common</code>
                        and
                        <br />
                        <code>modules/org.mod4j.updatesite</code>
                        and
                        <br />
                        <code>modules/Eclipse/org.mod4j.eclipse</code>
                    </li>
                    <li>
                        Choose "Import" > "
                        <b>Existing Project into Workspace</b>
                        " and Browse to the
                        <code>../modules/BusinessDomainDsl</code>
                        folder.
                        After choosing "Ok" and "Finish" the following modules are imported in your workspace:
                        <br />
                        <code>org.mod4j.dsl.businessdomain.generator</code>
                        <br />
                        <code>org.mod4j.dsl.businessdomain.mm</code>
                        <br />
                        <code>org.mod4j.dsl.businessdomain.validation</code>
                        <br />
                        <code>org.mod4j.dsl.businessdomain.xtext</code>
                        <br />
                        <code>org.mod4j.dsl.businessdomain.xtext.editor</code>
                    </li>
                    <li>
                        If you need to (re)generate the modelcode from a meta model, for instance the BusinessDomani meta model:
                        Open
                        <code>org.mod4j.dsl.businessdomain.mm/model/BusinessDomainDsl.genmodel
                        </code>
                        in the EMF Generator editor.
                    </li>
                    <li>
                        Right-click on
                        <code>BusinessDomainDsl</code>
                        in the editor pane, and choose
                        <q>Generate Model Code</q>
                        <br />
                        Normally you wouldn't need to add generated sources to the version control system (Subverson), but due
                        to not being able for us to run to perform this step outside Eclipse we've decided -for now- to add the generated code
                        (src-gen
                        folder) to Subversion. So the continuous integration build can build it and other modules can
                        depend on it.
                        <br />
                    </li>
                    <li>
                        You need to generate the code for Xtext and Xtext Editor projects: Right-click the file
                        <code>org.mod4j.dsl.businessdomain.xtext/src/genXtextEditor.oaw,
                        </code>
                        and choose
                        <br />
                        <q>Run As -> oAW Workflow</q>
                        from the context-menu.
                    </li>
                    <li>
                        Repeat the previous steps you took for importing the BusinessDomainDsl projects for:
                        <br />
                        <code>../modules/DataContractDsl</code>
                        and
                        <br />
                        <code>../modules/ServiceDsl</code>
                    </li>
                    <li>
                        Now import as
                        <b>Maven Project</b>
                        :
                        <br />
                        Choose "Import" > "Maven2 Project" > "Next" and Browse to the
                        <code>modules/org.mod4j.runtime.common</code>
                        folder. Then choose "Ok' and "Finish".
                        <br />
                        Do the same with:
                        <br />
                        <code>modules/org.mod4j.mavenplugin</code>
                    </li>
                </ol>
                Now you have imported and generated the necessary modules. The DSL editors are ready to use. There
                for you need
                to activate the newly created editor in a second Eclipse instance. See next section "Modeling".
            </subsection>
            <subsection name="Modeling">
                <ol>
                    <li>
                        Be sure you start a second Eclipse instance with the right memory settings. Add the following arguments
                        in the "Arguments" tab, see Run > Run Configurations...
                        <br />
                        Add to Vm arguments:
                        <q>-Xms512m -Xmx512m -XX:PermSize=512m -XX:MaxPermSize=512m</q>
                        <br />
                        Add to Program Arguments:
                        <q> -Dcom.sun.management.jmxremote </q>
                    </li>
                    <li>
                        To start the second Eclipse instance: Right-click the module
                        <code>org.mod4j.dsl.businessdomain.xtext.editor</code>
                        and choose
                        <q>Run As -> Eclipse Application</q>
                        from the context menu.
                    </li>
                    <li>
                        Choose "Import" > "
                        <b>Existing Project into Workspace</b>
                        " and Browse to the
                        <code>../modules/Examples/RecordShop-ExampleProject/RecordShop-dslModels
                        </code>
                        folder.
                        After choosing "Ok" and "Finish" the following modules are imported in your workspace:
                        <br />
                        <code>RecordShop-dslModels</code>
                    </li>
                    <li>
                        Now import as
                        <b>Maven Project</b>
                        :
                        <br />
                        Choose "Import" > "Maven2 Project" > "Next" and Browse to the
                        <code>../modules/Examples/RecordShop-ExampleProject</code>
                        folder. Then choose "Ok'
                        <br />
                        Uncheck the RecordShop-dslModels module (you already imported this one in the previous step)
                        and klick
                        "Finish".
                        <br />
                        After choosing "Ok" and "Finish" the following modules are imported in your workspace:
                        <br />
                        <code>RecordShop-domain</code>
                        <br />
                        <code>RecordShop-data</code>
                        <br />
                        <code>RecordShop-business</code>
                        <br />
                        <code>RecordShop-service</code>
                    </li>
                    <li>In the previous step the Q4E Maven plug-in not always recognizes the source folders correctly. Adjust the source
                        folders manually if you encounter compilation failures. Right-click on the project to adjust the "Build
                        Path" configuration. Add src/main/java, src/test/java, src/main/resources, generated-sources and
                        generated-resources to it.</li>
                    <li>
                        In the new Eclipse session you should be able to edit the .busmod, .sermod and .dtcmod model files in
                        the
                        <code>RecordShop-dslModels</code>
                        project.
                        <br />
                        Open the file
                        <code>RecordShop-dslModels/src/model/businessDomain/businessDomain/model.busmod
                        </code>
                        change this file as needed and save the file.
                    </li>
                    <li>
                        The previous step generated two new modules into the RecordShop-ExampleProject folder. See:
                        <code>../RecordShop-ExampleProject/RecordShop-domain
                        </code>
                        and
                        <code>../RecordShop-ExampleProject/RecordShop-data</code>
                        <br />
                        The modules are generated as a mulitmodule Maven project. To test and install the maven modules:
                        <br />
                        Open a command console and navigate to location of the parent-POM (../RecordShop-ExampleProject/pom.xml)
                        <br />
                        Give the command:
                        <code>
                            <b>mvn clean install</b>
                        </code>
                    </li>
                </ol>
            </subsection>

        </section>
    </body>
</document>
